"use strict";var _slicedToArray=function(){return function(i,t){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return function(i,t){var n=[],e=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(e=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);e=!0);}catch(i){o=!0,r=i}finally{try{!e&&a.return&&a.return()}finally{if(o)throw r}}return n}(i,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(i){if(Array.isArray(i)){for(var t=0,n=Array(i.length);t<i.length;t++)n[t]=i[t];return n}return Array.from(i)}var App={init:function(){this.boardDimension=3,this.board=new Array(this.boardDimension*this.boardDimension).fill(void 0),this.MAX="0",this.MIN="X",this.restartPauseDuration=3,this.moveAndGetUtil=this.moveAndGetUtil.bind(this),this.turnInformer=this.turnInformer.bind(this),this.randomRange=this.randomRange.bind(this),this.boardToOut=this.boardToOut.bind(this)},moveAndGetUtil:function(){return this.board=this.makeMove.apply(this,arguments),this.drawCell(arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]),this.utility.apply(this,arguments)},computerMove:function(){var i=this;this.turnInformer(this.board),this.chooseMove(this.board).then(function(t){return i.moveAndGetUtil(i.board,t,i.MAX)}).then(function(t){t[0]?i.handleTerminalConditions(t[1]):i.turnInformer(i.board)})},handleTerminalConditions:function(i){var t=this;log.debug("handleTerminalConditions got condition: "+i),-1===i?log.info("You win!"):1===i?log.info("Computer wins!"):0===i&&log.info("Draw!"),this.stopListenElms(this.boardElm),window.setTimeout(function(){return t.resetBoard()},1e3*this.restartPauseDuration)},resetBoard:function(){log.debug("resetBoard started"),this.board=new Array(this.boardDimension*this.boardDimension).fill(void 0),this.drawBoard(this.board),"X"===this.MAX&&this.computerMove()},boardToOut:function(i){for(var t=0;t<this.boardDimension;t++){var n=i.slice(t*this.boardDimension,(t+1)*this.boardDimension).map(function(i){return i||"_"}).join(" ");console.log(n)}},turnInformer:function(i){this.player(i)===this.MAX?log.info("Computer turn"):log.info("Player turn")},randomRange:function(i){return i[Math.floor(Math.random()*i.length)]}},Engine={start:function(){this.minimax=this.minimax.bind(this),this.utility=this.utility.bind(this),this.player=this.player.bind(this),this.actions=this.actions.bind(this),this.makeMove=this.makeMove.bind(this),this.getBestDebutMoves=this.getBestDebutMoves.bind(this),this.chooseMove=this.chooseMove.bind(this),this.logDepth=this.logDepth.bind(this),this.debug=0,this.logLine=1},minimax:function(i,t,n,e){var o=this;e=e||0;var r=this.utility(i,t,n),s=_slicedToArray(r,2),a=s[0],h=s[1];if(a)return this.logDepth(e,"utility",h),h;var l=this.makeMove(i,t,n);return this.player(l)===this.MAX?(this.logDepth(++e,"turn",this.MAX),Math.max.apply(null,this.actions(l).map(function(i){return o.logDepth(e,"move",i),o.minimax(l,i,o.MAX,e)}))):this.player(l)===this.MIN?(this.logDepth(++e,"turn",this.MIN),Math.min.apply(null,this.actions(l).map(function(i){return o.logDepth(e,"move",i),o.minimax(l,i,o.MIN,e)}))):void 0},utility:function(i,t,n){for(var e=this.makeMove(i,t,n),o=Math.ceil((t+1)/this.boardDimension)-1,r=t%this.boardDimension,s=0,a=0;a<this.boardDimension;a++)e[a*this.boardDimension+r]===n&&(s+=1);if(s===this.boardDimension&&n===this.MAX)return[!0,1];if(s===this.boardDimension&&n===this.MIN)return[!0,-1];for(var h=0,l=0;l<this.boardDimension;l++)e[o*this.boardDimension+l]===n&&(h+=1);if(h===this.boardDimension&&n===this.MAX)return[!0,1];if(h===this.boardDimension&&n===this.MIN)return[!0,-1];if(o===r){for(var d=0,u=0;u<this.boardDimension;u++)e[u+this.boardDimension*u]===n&&(d+=1);if(d===this.boardDimension&&n===this.MAX)return[!0,1];if(d===this.boardDimension&&n===this.MIN)return[!0,-1]}if(o===this.boardDimension-r-1){d=0;for(var m=0;m<this.boardDimension;m++)e[(this.boardDimension-m)*(this.boardDimension-1)]===n&&(d+=1);if(d===this.boardDimension&&n===this.MAX)return[!0,1];if(d===this.boardDimension&&n===this.MIN)return[!0,-1]}return this.actions(e)?[void 0,void 0]:[!0,0]},player:function(i){return i.reduce(function(i,t){return t?i+1:i},0)%2==0?"X":"0"},actions:function(i){var t=i.reduce(function(i,t,n){return t||i.push(n),i},[]);return t.length>0?t:void 0},makeMove:function(i,t,n){var e=[].concat(_toConsumableArray(i));return e[t]=n,e},getBestDebutMoves:function(i){var t=[];return t.push(0),t.push(this.boardDimension-1),t.push(this.board.length-this.boardDimension),t.push(this.board.length-1),this.boardDimension%2!=0&&t.push((this.board.length-1)/2),log.debug("All available debut moves: "+JSON.stringify(t)),t=t.filter(function(t){return i.includes(t)}),this.randomRange(t)},chooseMove:function(i){var t=this;return new Promise(function(n){var e,o=t.actions(t.board);if(o.length===t.board.length)e=t.getBestDebutMoves(o);else if(o.length===t.board.length-1){if(log.debug("We are on the second move routine, choosing for next move"),e=t.getBestDebutMoves(o),log.debug("Preliminary chosen move: "+e),t.boardDimension%2!=0){var r=(t.board.length-1)/2;log.debug("Available moves are: "+JSON.stringify(o)),o.includes(r)&&(e=r)}}else{o=t.actions(i).map(function(n){return[n,t.minimax(i,n,t.MAX)]}),log.debug("Available moves: "+JSON.stringify(o));var s=Math.max.apply(null,o.map(function(i){return i[1]}));log.debug("Max utility: "+s),o=o.filter(function(i){return i[1]===s}),log.debug("Available moves after max filter: "+JSON.stringify(o)),e=t.randomRange(o)[0]}n(e)})},logDepth:function(i){9===this.debug&&console.log(this.logLine+++". "+i+new Array(2*i).fill("-").join("")+(arguments.length<=1?void 0:arguments[1])+": "+(arguments.length<=2?void 0:arguments[2]))}},UI={listen:function(){log.debug("UI listen called"),this.drawBoard=this.drawBoard.bind(this),this.drawCell=this.drawCell.bind(this),this.symbolChoiceHandler=this.symbolChoiceHandler.bind(this),this.addElm=this.addElm.bind(this),this.handleClick=this.handleClick.bind(this),this.frmSymbolChoice=document.querySelector("#frmSymbolChoice"),this.frmSymbolChoice.removeEventListener("change",this.symbolChoiceHandler),this.frmSymbolChoice.addEventListener("change",this.symbolChoiceHandler),this.boardElm=document.querySelector("#boardElm"),this.boardCells=document.querySelectorAll(".board__cell"),this.initializeBoard(),this.drawBoard(this.board)},symbolChoiceHandler:function(i){var t=this;log.debug(i),new FormData(this.frmSymbolChoice).forEach(function(i){log.debug("User's choise: "+i),t.MIN=i,t.MAX="X"===t.MIN?"0":"X"}),this.resetBoard()},initializeBoard:function(){document.documentElement.style.setProperty("--boardDimension",this.boardDimension)},drawBoard:function(i){var t=i.map(function(i,t){return'<div class="board__cell" id="boardCellElm_'+t+'">\n                  <span>'+(i||"")+"</span>\n                </div>"}).join("");this.addElm(this.boardElm,t)},addElm:function(i,t){var n=this;i.innerHTML=t,i.childNodes.forEach(function(i){return i.addEventListener("click",n.handleClick)})},stopListenElms:function(i){var t=this;i.childNodes.forEach(function(i){return i.removeEventListener("click",t.handleClick)})},drawCell:function(i,t){document.querySelector("#boardCellElm_"+i).innerHTML=t},handleClick:function(i){i.currentTarget.removeEventListener(i.type,this.handleBoardClick),log.debug("Player clicked "+i.currentTarget.id);var t=i.currentTarget.id.split("_")[1];if(!this.board[t]){var n=this.moveAndGetUtil(this.board,t,this.MIN);log.debug("Condition after move to "+t+" is "+(Boolean(n[0])?"terminal":"non-terminal")),n[0]?this.handleTerminalConditions(n[1]):this.computerMove()}}};Object.assign(App,UI,Engine),App.init(),App.listen(),App.start(),App.drawBoard(App.board);
//# sourceMappingURL=script.js.map
